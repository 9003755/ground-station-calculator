# 01_两边及夹角功能修改为两边及任意一角_20251222.md

## 1. 问题和需求描述
- **类型**: 重要的修改 (功能设计变更)
- **描述**: 用户要求修改“三角形计算器”中的“两边及夹角”功能。
  - 原功能：已知两边及其夹角，计算第三边及其他两角。
  - 新需求：已知任意两条边和其中一个角的角度（不仅仅是夹角），自动算出另一条边和另外两个角。
  - **历史记录**: 这是第一次提出该需求。

## 2. 问题根源分析
- 当前代码 (`app.js` 中的 `calcSAS` 函数) 仅实现了“边-角-边” (SAS) 的计算逻辑，即利用余弦定理 $c^2 = a^2 + b^2 - 2ab\cos(C)$ 直接求第三边。
- 新需求属于“边-边-角” (SSA) 的情况，或者涵盖了 SAS。如果是 SSA，可能存在 0 个、1 个或 2 个解，需要更复杂的正弦定理逻辑进行判断和计算。

## 3. 查找问题根源的路径和办法
- 检查 `index.html` 中 `id="calc-triangle"` 部分，定位到 `data-tri-tab="sas"` 相关的 HTML 结构。
- 检查 `app.js` 中 `calcSAS` 函数的实现，确认其仅依赖余弦定理。
- 确认现有界面仅允许输入“夹角”，需要改为允许用户选择已知角是“夹角”还是“非夹角”（即对应某条已知边的角）。

## 4. 解决问题的策略和方法
1.  **修改 UI (`index.html`)**:
    - 将“两边及夹角”标签改为更通用的描述，例如“已知两边一角”。
    - 在输入区域，保留输入两个边长 (`side1`, `side2`)。
    - 修改角度输入方式：用户输入一个角度，并选择该角度是 `side1` 的对角、`side2` 的对角，还是两边的夹角。
2.  **修改逻辑 (`app.js`)**:
    - 重构计算函数（原 `calcSAS` 或新建）。
    - 获取输入的两边 $a, b$ 和角度 $\theta$。
    - 根据用户选择的角度类型进行分支处理：
        - **情况 A：夹角 (SAS)** -> 维持原有余弦定理逻辑。
        - **情况 B：$a$ 的对角 (SSA)** -> 使用正弦定理 $\frac{a}{\sin A} = \frac{b}{\sin B}$ 求 $\sin B$。
            - 检查 $\sin B$ 的值：
                - $> 1$: 无解。
                - $= 1$: 直角，1 解。
                - $< 1$: 可能有 1 解或 2 解（需判断 $a$ 与 $b$ 的大小关系及角度性质）。
        - **情况 C：$b$ 的对角 (SSA)** -> 同上，对称处理。
    - 输出结果时，如果存在多解，需要显示所有可能的解（或者根据通常需求，如果用户场景是地理/物理实体，可能默认取某一合理值，但标准数学计算器应提示多解）。*考虑到地面站计算器场景，可能需要明确提示，这里先按标准数学解法实现，若有多解并在界面上展示*。
    - **简化策略**: 为避免界面过于复杂，先假设用户输入的数据能构成唯一确定三角形，或者在有多解时列出。但根据需求描述“自动算出另一条边和另外两个角”，可能期望直接给出一个最可能的解。我们将实现标准逻辑：若有两解，显示两组结果；若无解，提示错误。

## 5. 修改和增加的文件
- `index.html`: 修改三角形计算器的表单结构。
- `app.js`: 修改计算逻辑函数。

## 6. 修改的代码
### index.html
```html
<div id="tri-form-sas" class="form" style="display:none">
  <label>已知角(°)<input type="number" id="tri-sas-angle" step="0.000001"></label>
  <div class="radio-group">
    <label><input type="radio" name="tri-sas-angle-type" value="included" checked> 两边夹角</label>
    <label><input type="radio" name="tri-sas-angle-type" value="side1"> 边1对角</label>
    <label><input type="radio" name="tri-sas-angle-type" value="side2"> 边2对角</label>
  </div>
  <label>边1<input type="number" id="tri-sas-side1" step="0.000001"></label>
  <label>边2<input type="number" id="tri-sas-side2" step="0.000001"></label>
  <button id="tri-sas-calc">计算</button>
</div>
```

### app.js
(逻辑更新部分，支持 SAS 与 SSA 计算，包括正弦定理和余弦定理的分支处理，详情见 app.js)

## 7. 修改的功能
- 三角形计算器 -> “两边及夹角”模式升级为“两边及任意一角”模式。

## 8. 修改的模块
- HTML DOM 结构 (`#tri-form-sas`)
- JS 事件监听与计算函数

## 9. 修改的接口
- 无后端接口修改，仅前端逻辑。

## 10. 修改的数据结构
- 无持久化数据结构修改。

## 11. 备份策略
- 已创建本地文件备份：`backup/index.html.bak`, `backup/app.js.bak`
- Git 标签：`backup_before_modify_triangle_calc_20251222` (由于远程验证失败，仅本地有效)

## 12. Git 提交点和回滚标签
- 提交前 Hash: `e579d456864db57d2a63bcc1b438349643448bb1`
- 回滚操作：`git reset --hard e579d45...` 或使用备份文件覆盖。

## 13. 详细的回滚操作指南
1.  若需回滚代码：
    - `cp backup/index.html.bak index.html`
    - `cp backup/app.js.bak app.js`
2.  若需回滚 Git 状态：
    - `git reset --hard e579d45`
